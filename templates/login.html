<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DeepScan AI | Secure Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="auth-page">

    <button class="back-float-btn" onclick="goBack()">‚Üê Back</button>

    <main class="auth-wrapper">
        <section class="auth-card">
            <header>
                <h2 class="auth-title">DeepScan<span class="brand-dot">.AI</span></h2>
                <p class="auth-subtitle">Secure Neural Access Portal</p>
            </header>

            <div class="auth-box" id="login-box">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="login-email" placeholder="you@domain.com" required>
                </div>
                <div class="input-group password-wrap">
                    <label>Password</label>
                    <input type="password" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="8" required>
                    <span class="toggle-pass" onclick="togglePassword()">üëÅÔ∏è</span>
                    <small class="caps-warning hidden">‚ö† Caps Lock is ON</small>
                </div>
                <button class="auth-btn" id="login-btn" onclick="login()">Login</button>
                <button class="bio-btn">üß™ Scan Biometrics</button>
                <p class="auth-switch" onclick="toggle()">Create new account</p>
            </div>

            <div class="auth-box hidden" id="register-box">
                <div class="input-group">
                    <label>Name</label>
                    <input type="text" id="reg-name" required>
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="reg-email" required>
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="reg-pass" minlength="8" required>
                </div>
                <button class="auth-btn" onclick="register()">Register</button>
                <p class="auth-switch" onclick="toggle()">Already have an account?</p>
            </div>
        </section>
    </main>

    <script>
        const loginBox = document.getElementById("login-box");
const registerBox = document.getElementById("register-box");
const loginEmail = document.getElementById("login-email");
const loginPass = document.getElementById("login-pass");
const loginBtn = document.getElementById("login-btn");
const capsWarning = document.querySelector(".caps-warning");
const authCard = document.querySelector(".auth-card");
const bioBtn = document.querySelector(".bio-btn");

/* --- UI TOGGLES --- */
function toggle() {
    loginBox.classList.toggle("hidden");
    registerBox.classList.toggle("hidden");
}

function togglePassword() {
    loginPass.type = loginPass.type === "password" ? "text" : "password";
}

function goBack() {
    window.location.href = "/";
}

function shakeError(msg) {
    authCard.classList.add("error");
    setTimeout(() => authCard.classList.remove("error"), 450);
    console.error(msg);
}

/* --- LISTENERS --- */
loginPass.addEventListener("keyup", e => {
    capsWarning.classList.toggle("hidden", !e.getModifierState("CapsLock"));
});

loginPass.addEventListener("input", () => {
    const val = loginPass.value;
    loginPass.classList.remove("weak", "medium", "strong");
    if (val.length >= 12) loginPass.classList.add("strong");
    else if (val.length >= 8) loginPass.classList.add("medium");
    else if (val.length > 0) loginPass.classList.add("weak");
});

bioBtn.addEventListener("click", () => {
    bioBtn.innerText = "üîç Scanning...";
    bioBtn.classList.add("scanning");
    setTimeout(() => {
        bioBtn.innerText = "‚úÖ Biometrics Verified";
        bioBtn.classList.remove("scanning");
    }, 2200);
});

/* --- BACKEND CORE FUNCTIONS --- */

async function register() {
    const name = document.getElementById("reg-name").value;
    const email = document.getElementById("reg-email").value;
    const pass = document.getElementById("reg-pass").value;

    if (!name || !email || !pass) return shakeError("Fill all fields");

    try {
        const response = await fetch("/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, pass }) 
        });
        const data = await response.json();
        if (data.success) {
            alert("Account created! Please login.");
            toggle(); 
        } else {
            shakeError(data.message);
        }
    } catch (err) {
        shakeError("Registration failed.");
    }
}

async function login() {
    const email = loginEmail.value;
    const password = loginPass.value;

    if (!email || !password) return shakeError("Fields cannot be empty");

    loginBtn.classList.add("loading");
    
    const formData = new FormData();
    formData.append("email", email);
    formData.append("password", password);

    try {
        const res = await fetch("/login", {
            method: "POST",
            body: formData
        });
        const data = await res.json();

        if (data.success) {
            localStorage.setItem("ds_logged", "true");
            window.location.href = "/"; 
        } else {
            shakeError(data.message);
        }
    } catch (err) {
        shakeError("Server error.");
    } finally {
        loginBtn.classList.remove("loading");
    }
}
    </script>
</body>
</html>